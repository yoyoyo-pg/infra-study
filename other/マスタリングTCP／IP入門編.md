
# マスタリングTCP／IP入門編

- [マスタリングTCP／IP入門編](#マスタリングtcpip入門編)
  - [第1章 ネットワーク基礎知識](#第1章-ネットワーク基礎知識)
  - [第2章 TCP／IP基礎知識](#第2章-tcpip基礎知識)
    - [TCP／IPの成り立ち](#tcpipの成り立ち)
    - [TCP／IPの標準化](#tcpipの標準化)
    - [インターネットの基礎知識](#インターネットの基礎知識)
    - [TCP／IPの階層の補足](#tcpipの階層の補足)
  - [第3章 データリンク](#第3章-データリンク)
    - [3.1 データリンクの役割](#31-データリンクの役割)
    - [3.2 データリンクの技術](#32-データリンクの技術)
      - [3.2.1 MACアドレス](#321-macアドレス)
      - [3.2.2, 3.2.3 媒体共有型と、媒体非共有型のネットワーク](#322-323-媒体共有型と媒体非共有型のネットワーク)
      - [3.2.4 MACアドレスによる転送](#324-macアドレスによる転送)
      - [3.2.6 VLAN](#326-vlan)
    - [3.3 イーサネット（Ethernet）](#33-イーサネットethernet)
      - [3.3.1 イーサネットの接続形態](#331-イーサネットの接続形態)
      - [3.3.2 イーサネットにはいろいろな種類がある](#332-イーサネットにはいろいろな種類がある)
      - [3.3.3 イーサネットの歴史](#333-イーサネットの歴史)
        - [IEEE802](#ieee802)
      - [3.3.4 イーサネットのフレームフォーマット](#334-イーサネットのフレームフォーマット)
    - [3.4 無線通信](#34-無線通信)
      - [3.4.1 無線通信の種類](#341-無線通信の種類)
      - [3.4.2 IEEE802.11](#342-ieee80211)
        - [CSMA/CA](#csmaca)
      - [3.4.3 IEEE802.11b、IEEE802.11g](#343-ieee80211bieee80211g)
      - [3.4.4 IEEE802.11a](#344-ieee80211a)
      - [※IEEE802.11n,IEEE802.11acは省略](#ieee80211nieee80211acは省略)
      - [3.4.7 IEEE802.11ax（Wi-Fi 6）](#347-ieee80211axwi-fi-6)
      - [3.4.8 無線LANを使用する場合の留意点](#348-無線lanを使用する場合の留意点)
      - [3.4.9 WiMAX](#349-wimax)
      - [3.4.10 Bluetooth](#3410-bluetooth)
      - [※ZigBee、LPWAは省略](#zigbeelpwaは省略)
    - [3.5 PPP（Point-to-Point Protocol）](#35-ppppoint-to-point-protocol)
      - [3.5.1 PPPとは](#351-pppとは)
      - [LCPとNCP、PPPのフレームフォーマット、PPPeEは省略](#lcpとncppppのフレームフォーマットpppeeは省略)
    - [3.6 その他データリンク](#36-その他データリンク)
      - [※ATM、POS、ファイバーチャネル、iSCSI、InfiniBand、IEEE1394、DOCSIS、高速PLCは省略](#atmposファイバーチャネルiscsiinfinibandieee1394docsis高速plcは省略)
      - [3.6.7 HDMI](#367-hdmi)
    - [3.7 公衆アクセス網](#37-公衆アクセス網)
      - [3.7.1 アナログ電話回線](#371-アナログ電話回線)
      - [3.7.2 モバイル通信サービス](#372-モバイル通信サービス)
      - [※ADSLとFTTHは省略](#adslとftthは省略)
      - [3.7.5 ケーブルテレビ](#375-ケーブルテレビ)
      - [3.7.6 専用回線（専用線）](#376-専用回線専用線)
      - [3.7.7 VPN（Virtual Private Network）](#377-vpnvirtual-private-network)
        - [IP-VAN](#ip-van)
        - [広域イーサネット](#広域イーサネット)
      - [3.7.8 公衆無線LAN](#378-公衆無線lan)
      - [※その他の公衆通信サービスは省略](#その他の公衆通信サービスは省略)
  - [第4章 IP](#第4章-ip)
    - [4.1 IPはインターネット層のプロトコル](#41-ipはインターネット層のプロトコル)
      - [4.1.1 IPはOSI参照モデルの第3層に相当](#411-ipはosi参照モデルの第3層に相当)
      - [4.1.2 ネットワーク層とデータリンク層の関係](#412-ネットワーク層とデータリンク層の関係)
    - [4.2 IPの基礎知識](#42-ipの基礎知識)
      - [4.2.1 IPアドレスはネットワーク層のアドレス](#421-ipアドレスはネットワーク層のアドレス)
      - [4.2.2 経路制御（ルーティング）](#422-経路制御ルーティング)
      - [4.2.3 データリンクの抽象化](#423-データリンクの抽象化)
      - [4.2.4 IPはコネクションレス型](#424-ipはコネクションレス型)
    - [4.3 IPアドレスの基礎知識](#43-ipアドレスの基礎知識)
    - [4.4 経路制御（ルーティング）](#44-経路制御ルーティング)
    - [4.5 IPの分割処理と再構築処理](#45-ipの分割処理と再構築処理)
    - [4.6 IPv6（IP version 6）](#46-ipv6ip-version-6)
    - [4.7 IPv4ヘッダ](#47-ipv4ヘッダ)
    - [4.8 IPv5のヘッダフォーマット](#48-ipv5のヘッダフォーマット)
  - [第5章 IPに関連する技術](#第5章-ipに関連する技術)

## 第1章 ネットワーク基礎知識

- ISO（国際標準化機構）がOSI参照モデルを定めた
- TCP／IPはIETF（インターネット技術の標準化を推進する任意団体）で標準化がすすめられているプロトコル
- SNSで文書を送る例を基に、OSI参照モデルの各層を解説
  - アプリケーション層・・・メッセージ、宛先の情報
  - プレゼンテーション層・・・ネットワーク全体で統一された表現形式⇔コンピュータやソフトウェアに適した表現形式の変換をする
    - 符号化形式・・・UTF-8、Shift_JISなど
  - セッション層・・・どんなコネクションを使って転送するか、データ転送自体の機能は持たない
  - トランスポート層・・・コネクションの確立や切断
  - ネットワーク層・・・ネットワーク間の接続がある環境で、ホスト間のデータの受け渡しを行う。IPアドレスが必要
  - データリンク、物理層・・・MACアドレスが指定。物理マシンの一区間ごとにパケットのヘッダとして付与
- 通信方式の種類
  - コネクション型とコネクションレス型・・・コネクションレス型はコネクションを確立せずに送信
  - 回線交換とパケット交換・・・パケット交換ではパケット交換機（ルーター）によって通信回線が結ばれる
    - ルーターの中にはバッファと呼ばれる記憶領域があり、パケットは一旦ここに格納されるが、大量のパケットが流れると溢れてパケットロスになる
- IPアドレスとMACアドレス
- IPアドレスは階層性があるが、MACアドレスには階層性が無い
- ネットワークの途中にある通過点では、各パケットのアドレスを見てどのネットワークインターフェースから送り出すかを決める
  - その為にアドレスごとに送出インターフェースを記したテーブルを参照する
  - MACアドレスの場合は転送表（フォワーディングテーブル）と言い、IPアドレスの場合は経路制御表（ルーティングテーブル）

## 第2章 TCP／IP基礎知識

### TCP／IPの成り立ち

- 1960年代に、大学や各研究所で新しい通信技術の研究が行われるように
- 1960年代後半には、パケット交換技術・パケット通信に注目するように
  - 分散型のネットワークであれば、攻撃を受けても迂回路がある限り通信を継続できる
  - また、パケット通信を利用する事で、複数のユーザーで同時に一つの回線を共有する事ができ、回線の利用効率が向上する
- 1969年に、ARPANET（アーパネット）と呼ばれるネットワークが構築された
  - パケット通信の実用性の試験がされ、ARPANETはインターネットの起源とされている
- 1975年に、ARPANET内の研究グループによってTCP／IPが誕生
- 1980年代は大学や研究所などでLANが発達するとともにUNIXの普及が急速に進み、同時にTCP／IPによるネッワーク構築が盛んにおこなわれるように
  - TCP／IPによる世界的なネットワークを「インターネット」と呼ぶようになったのはこの頃から
- 1990年代は企業や一般家庭に対して、ISP（インターネットサービスプロバイダ）がインターネットへの接続を提供するように

### TCP／IPの標準化

- 多くの場合、TPC／IPはTCPとIPだけでなく、プロトコル群の総称として使われる
- 標準化については、他の標準化と比べると２つの点が大きく異なる
  - オープンであり、IEFEでの議論を通して決められる
  - 実際に使えるプロトコルであるかが重視される
- 標準化しようとするプロトコルはRFC（Request For Comments）として番号が割り振られ、ドキュメントとしてIETFのftpおよびwebサーバを通じて閲覧可能となる

※全然関係ないが、ひたすらQiitaにjoke-rfcを纏めている方を発見した
<https://qiita.com/yoshi389111>

### インターネットの基礎知識

- 現在、インターネットというとARPANET（アーパネット）から発展し、全世界を接続しているコンピュータネッ- ワークを指す
- インターネットとTCP／IPの関係として、インターネットのプロトコルと言えばTCP／IPという事になる
- ISPや地域ネットワークに属する形で、組織や家庭のネットワークが存在している
- ネットワーク同士はNOC（Network Operation Center）で接続される
- ネットワーク運用者や運用方針が異なるネットワークを対等に接続するポイントはIX（Internet Exchange）と- ばれる
- NOCとは、ISP等が地域ごとに設ける集中的な運用拠点を指す事が多い
- <https://e-words.jp/w/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC.html>

### TCP／IPの階層の補足

- ネットワーク層（インターネット層）
  - インターネットは、インターネット層の機能を備えたネットワーク（要はデータリンク層、物理層は抽象化される）
  - インターネットに接続される全てのホストやルーターは必ずIPの機能を実装しなければならない
- トランスポート層
  - アプリケーションプログラム間の通信を実現する
- アプリケーション層
  - アプリケーションプログラムの中で実現される
- パケットの送信例
  - 各階層では送信されるデータにヘッダと呼ばれる情報が付加される
  - イーサネットヘッダ、IPヘッダ、TCPヘッダ
  - それぞれのヘッダには少なくとも「宛先と送信元のアドレス」と「上位層のプロトコルが何かを示す情報」が入っている

## 第3章 データリンク

### 3.1 データリンクの役割

- TCP／IPでは、データリンク層と物理層が透過的に機能している事を前提にしている
- データリンクとは、直接的に接続されているコンピュータ間の通信を可能にするプロトコル
- この章では、MACアドレス、スイッチング技術、ループ検出、VLAN、無線LAN、PPP等について紹介する
- データリンクのセグメントについて
  - 区切られた1つのネットワークという意味でセグメントが使われる
  - 例えばリピーターを介して2つのケーブルを接続している例だと、物理層の観点から見ると1つのケーブルで1セグメントだが、ネットワーク層の観点から見ると、1セグメントと見なされる

### 3.2 データリンクの技術

#### 3.2.1 MACアドレス

- MACアドレスはイーサネットや無線LAN、Bluetoothでも使われる
  - 48ビット長で、ベンダ識別子とベンダ内の識別子で構成され世界中で唯一となる
  - ただし、同じデータリンク内に同一のMACアドレスが存在しなければいいという話なので、絶対に唯一の値とは限らない
  - ベンダ識別子はIEEEが割り当てる
    - 00-00-0Eは富士通、という形で割り当てられている
    - [MACベンダー検索くん](http://mobile.shinsv.mydns.jp/tech/mac_address/cm.html)

#### 3.2.2, 3.2.3 媒体共有型と、媒体非共有型のネットワーク

- 媒体共有型
  - 通信媒体を複数のノードで共有する
  - 基本的には半二重通信となり、通信の優先権を制御する仕組みが必要
- 媒体非共有型
  - 通信媒体を共有せずに占有する方式
  - スイッチに接続し、スイッチがフレームを転送する
  - 全二重通信が可能で、送受信を同時に行える

#### 3.2.4 MACアドレスによる転送

- 媒体非共有型で利用されていたスイッチ技術をイーサネットで利用できるようにしたのがスイッチングハブやイーサネットスイッチ
- スイッチの送出インターフェース（ポート）とMACアドレスを記したテーブルを転送表といい、スイッチで自動的に生成される
  - どのホストがどのインターフェースに接続されているかは、パケットの送受信で判明し、転送表に書き込む
  - これをスイッチでの自己学習という
- MACアドレスに階層性はないので、転送表のエントリにはそのデータリンク内に存在する機器の数だけ必要
  - 転送表の検索にかかる時間も長くなるので、たくさんの端末をつなげる場合は複数のデータリンクに分ける

#### 3.2.6 VLAN

- スイッチのポートごとにセグメントを分ける事で、ブロードキャストのトラフィックが流れる範囲を区切れる
- 異なるセグメント間で通信を行うには、ルーターの機能を備えたスイッチ（L3）を利用するか、セグメント間をルーターで結ぶ必要がある

### 3.3 イーサネット（Ethernet）

- データリンクで現在最も普及しているのがイーサネット
- 制御の仕組みが単純で、ほかのデータリンクよりもNICやデバイスドライバが作りやすく、低価格で利用できたことがイーサネット普及の大きな要因でもある

#### 3.3.1 イーサネットの接続形態

- イーサネット普及当初は同軸ケーブルを利用する媒体共有型の接続が一般的
- 現在では、端末とスイッチの間を占有のケーブルで接続する形に

#### 3.3.2 イーサネットにはいろいろな種類がある

- 10BASE,100BASE,1000BASE,10GBASEとあるが、それぞれ10Mbps,100Mbps,1Gbps,10Gbpsといった伝送速度を意味している
- 後ろに5,2,T,Fなどの文字が入るが、これは媒体の違いを意味している

#### 3.3.3 イーサネットの歴史

- イーサネットは同軸ケーブルを使う10BASE5が最初に規格化された
- 歴史的には多様なイーサネットがあるが、いずれもIEEE802.3分科会で標準化されている

##### IEEE802

- IEEE（The Institute of Electrical and Electronics Engineers：米国電気電子技術者協会）委員会では、様々なLAN技術の標準化を進めている
- 802という数字は1980年2月にLanの標準化のプロジェクトが始まったことに由来している

#### 3.3.4 イーサネットのフレームフォーマット

- イーサネットフレームの先頭には1と0を交互に並べたプリアンプルと呼ばれるフィールドが付けられる
- フレームの中にはMACアドレス、データ、FCS（フレームが壊れていないかチェックする為のフィールド）がある

### 3.4 無線通信

- 電波や赤外線、レーザー光線などを利用する
- 無線通信の中でオフィス内のようなLANの範囲を比較的高速で接続する物を無線LANと呼ぶ

#### 3.4.1 無線通信の種類

- 通信距離に応じて、分類が出来る
- IEEE802委員会で、PAN~RANの規格化が進められている

| 短距離無線  | 規格化団体  | 技術名称        |
|------------|------------|-----------------|
| 短距離無線  | 個別       | RF-ID           |
| 無線 PAN   | IEEE802.15 | Bluetooth       |
| 無線 LAN   | IEEE802.11 | Wi-Fi           |
| 無線 MAN   | IEEE802.16, IEEE802.20| WiMAX |
| 無線 RAN   | IEEE802.22 | ---             |
| 無線 WAN   | 3GPP       | 3G, LTE, 4G, 5G |

#### 3.4.2 IEEE802.11

- 多くの規格の総称として用いられる場合と、無線LANの一通信方式として用いられる場合がある
- 一通信方式のIEEE802.11としては、物理層で電波もしくは赤外線を用いて、1Mbpsもしくは2Mbpsの通信速度を実現する規格（後発の規格に劣る為、ほとんど利用されていない）

##### CSMA/CA

- 無線LANが利用する電波は有限なので、媒体共有型のネットワーク
- イーサネットで採用されているCSMA/CDと似たCSMA/CAというアクセス制御方式を採用している
  - データを送信してよい状態か確認し、ランダムな時間待ってからデータ送信を開始する事で衝突を回避

#### 3.4.3 IEEE802.11b、IEEE802.11g

- 2.4GHz帯の電波を利用
- 最大11Mbpsおよび54Mbps

#### 3.4.4 IEEE802.11a

- 5GHz帯の電波を利用
- 最大54Mbps

#### ※IEEE802.11n,IEEE802.11acは省略

#### 3.4.7 IEEE802.11ax（Wi-Fi 6）

- 2.4GHzまたは5GHz帯を利用
- 最大9.6Gbpsの伝送速度を実現

#### 3.4.8 無線LANを使用する場合の留意点

- 2018年にWPA3（鍵長128/192bit）が登場したが、それまではWPA2（AESベース、鍵長128bit）
- 電子レンジを動作させると2.4GHz帯の転送能力が著しく低下する場合

#### 3.4.9 WiMAX

- Worldwide Interoperability for Microwave Accessの略
- マイクロ波を使って企業や自宅への無線接続を行う方式
- 無線MANに属し、大都市圏をエリアとする広範囲なワイヤレスネットワークをサポートする

#### 3.4.10 Bluetooth

- IEEE802.11b/gなどと同じ2.4GHz帯を使って通信する
- Bluetooth4.0では低消費電力を実現するBluetooth Low Energyが策定され、IoTデバイスなどで活用されている

#### ※ZigBee、LPWAは省略

### 3.5 PPP（Point-to-Point Protocol）

#### 3.5.1 PPPとは

- 1対1でコンピュータを接続するためのプロトコル
- イーサネットやFDDiはデータリンク層、物理層に関係していたが、PPPは純粋なデータリンクのプロトコル
- 電話回線やISDN、専用線などで利用されている
- ADSLやケーブルテレビなどを使ったインターネット接続でPPPoE（PPP over Ethernet）として利用されるように
  - 家庭内LANやルータなどの機器と、ISP内に設置された通信機器の間で接続を確立する手段として利用される

> [!NOTE]
> 近年ではイーサネットを前提としたIPoEが登場し、ネットワーク終端装置を必要とせずにインターネットに接続できる場合も

#### LCPとNCP、PPPのフレームフォーマット、PPPeEは省略

### 3.6 その他データリンク

#### ※ATM、POS、ファイバーチャネル、iSCSI、InfiniBand、IEEE1394、DOCSIS、高速PLCは省略

#### 3.6.7 HDMI

- 2009年に公開されたバージョン1.4からイーサネットのフレームを伝送する企画が追加
- HDMIケーブルを使ってTCP/IPによる通信が可能に

### 3.7 公衆アクセス網

- LANなどのような構内の接続ではなく、外部と接続する場合に使用する公衆通信サービスについて解説
- 公衆通信サービスとは、NTTやKDDI、ソフトバンクなどの通信事業者に料金を払って通信回線を借りる形態

#### 3.7.1 アナログ電話回線

- いわゆる固定電話回線を利用して通信を行う
- 特別な通信回線を必要とせず、一般家庭に広く普及している電話網をそのまま利用できる
- 現在はほとんど利用されていない

#### 3.7.2 モバイル通信サービス

- 1G,2G,PHS,3G,4G-LTEと規格化が進んでいる
- 5Gは上り480Mbps、下り最大10〜20Gbpsほど

#### ※ADSLとFTTHは省略

#### 3.7.5 ケーブルテレビ

- 電波を使うテレビ放送をケーブルを使って放送
- ケーブルテレビを使ったインターネット接続サービスが広く行われるように
  - 放送に使われていない空いているチャンネルをデータ通信専用に利用
- インターネットへの接続は加入者宅からケーブルモデムで信号変換され、ケーブルテレビ網を通りISPに接続される

#### 3.7.6 専用回線（専用線）

- イーサネット専用線サービスなど

#### 3.7.7 VPN（Virtual Private Network）

- VPNサービスにはIP-VPN、広域イーサネットがある

##### IP-VAN

- IPネットワークにVPNを構築する
- MPLS(Multiprotocol Label Switching)技術を用いて、パケットへのラベル付けにより通信事業者のネットワーク内に仮想的な独自ネットワークを作り上げる
- IP-VPNサービス以外にも、企業が独自にインターネット上にVPNを構築する場合もある、IPsecにより実現する方法が一般的になっている（IPsecについては九章で解説）

##### 広域イーサネット

- IP-VPNがIP層での接続サービスであるのに対して、広域イーサネットはデータリンク層であるイーサネットを用いたVLAN（バーチャルLAN）を利用する
- イーサネットをそのまま利用するので、TCP/IP以外のプロトコルも利用できる
- 広域イーサネットは通信事業者が構築するVLANを、利用企業が専用で利用する形になるので、不要なパケットを流さないように利用者が工夫した上で運用する事が必要に

#### 3.7.8 公衆無線LAN

- Wi-Fi（IEEE802.11bなど）を利用したサービス

#### ※その他の公衆通信サービスは省略

## 第4章 IP

- この章ではIPについて説明

### 4.1 IPはインターネット層のプロトコル

#### 4.1.1 IPはOSI参照モデルの第3層に相当

- IPはOSI参照モデルの第3層のネットワークに相当する
- ネットワーク層の役割は「終点ノード間の通信を実現する」こと
- データリンクを超えた通信をする為にはネットワーク層が必要

#### 4.1.2 ネットワーク層とデータリンク層の関係

- データリンク層は1区間の通信を実現するのに対して、ネットワーク層は最終目的地までの通信を実現する
- 旅行で言う所の、切符や航空券がデータリンク層で、旅行の行程表がネットワーク層

### 4.2 IPの基礎知識

#### 4.2.1 IPアドレスはネットワーク層のアドレス

- IPアドレスの形式は、ホストがどのような種類のデータリンクに接続されていても、全く同じものが使われる
- イーサネットも、無線LANも、PPPでも、IPアドレスの形式は同じ
- ネットワーク層には、データリンク層の性質を抽象化する役割がある
- TCP/IPで通信するすべてのホストやルーターには、必ずIPアドレスを設定する必要がある
  - ブリッジやスイッチングハブなど、物理層やデータリンク層でパケットを中継する機器には設定する必要はない

#### 4.2.2 経路制御（ルーティング）

#### 4.2.3 データリンクの抽象化

#### 4.2.4 IPはコネクションレス型

### 4.3 IPアドレスの基礎知識

### 4.4 経路制御（ルーティング）

### 4.5 IPの分割処理と再構築処理

### 4.6 IPv6（IP version 6）

### 4.7 IPv4ヘッダ

### 4.8 IPv5のヘッダフォーマット

## 第5章 IPに関連する技術
